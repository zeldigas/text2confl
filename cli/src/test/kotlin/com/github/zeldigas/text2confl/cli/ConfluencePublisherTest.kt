package com.github.zeldigas.text2confl.cli

import assertk.assertThat
import assertk.assertions.isInstanceOf
import assertk.assertions.isNotNull
import assertk.assertions.isTrue
import com.github.ajalt.clikt.core.CliktCommand
import com.github.ajalt.clikt.core.parse
import com.github.ajalt.clikt.core.requireObject
import com.github.ajalt.clikt.core.subcommands
import com.github.zeldigas.text2confl.core.ServiceProvider
import com.github.zeldigas.text2confl.core.ServiceProviderImpl
import org.junit.jupiter.api.Test

internal class ConfluencePublisherTest {

    @Test
    internal fun `Service provider test`() {
        val command = MockCommand()
        val cli = ConfluencePublisher().subcommands(command)

        cli.parse(listOf("test"))

        assertThat(command.executed).isTrue()
    }

    class MockCommand : CliktCommand(name = "test") {

        val provider: ServiceProvider? by requireObject()

        var executed: Boolean = false

        override fun run() {
            assertThat(provider).isNotNull()
                .isInstanceOf(ServiceProviderImpl::class)
            executed = true
        }
    }

}